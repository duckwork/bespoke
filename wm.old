#!/usr/bin/env bash

# WM 0.1
# wrapper and namespacer for wmutils

# export WMD="${XDG_CONFIG_HOME:-$HOME/.config}/wm"
export WMD="$HOME/projects/wm";
export UTIL="$WMD/util.sh";
export WMscripts="$WMD/scripts";
mkdir -p $WMD $WMscripts

export WMC="$WMD/config";
touch $WMC

export WMtmp="/tmp/wm";
mkdir -p $WMtmp;
export WMstate="$WMtmp/state"

. $UTIL;

main() {
  cmd="${1}"; shift;
  case "$cmd" in
    e|edit) # edit a script
      file="$WMscripts/$1";
      if [ -w "$file" ]; then
        log $EDITOR $file;
      elif [ ! -f $file ]; then
        log $EDITOR $file
      else
        die $E_FNF "'$1' is not a file in $WMscripts or is not writable"
      fi
      ;;
    *) # anything else
      CMD="$WMscripts/$cmd";
      if [ -x "$CMD" ]; then
        log $CMD $@;
      elif [ -f "$CMD" ]; then
        chmod +x "$CMD"
        wm $CMD $@;
      else
        die $E_EXE "No permissions or unavailable file"
      fi
      ;;
  esac
}

[ -z "$1" ] && exit 1;

export WMVERBOSE=0
QUIET=0
while true; do
  case "$1" in
    '-v')
      export WMVERBOSE=1; shift;
      break;
      ;;
    '-l')
      ls $WMscripts;
      exit;
      ;;
    '-q')
      QUIET=1; shift;
      break;
      ;;
    *) break ;;
  esac
done

if [ $QUIET -eq 1 ]; then
  main $@ >/dev/null 2>&1;
else
  main $@;
fi
